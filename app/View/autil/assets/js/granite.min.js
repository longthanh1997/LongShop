(function(d,e,m){var f;e.Granite=e.Granite||{};e.Granite.$=e.Granite.$||d;e._g=e._g||{};e._g.$=e._g.$||d;f=Granite.HTTP;d.ajaxSetup({externalize:!0,encodePath:!0,hook:!0,beforeSend:function(g,c){"undefined"!==typeof G_IS_HOOKED&&G_IS_HOOKED(c.url)||(c.externalize&&(c.url=f.externalize(c.url)),c.encodePath&&(c.url=f.encodePathOfURI(c.url)));c.hook&&(g=f.getXhrHook(c.url,c.type,c.data))&&(c.url=g.url,g.params&&("GET"===c.type.toUpperCase()?c.url+="?"+d.param(g.params):c.data=d.param(g.params)))},statusCode:{403:function(d){"Authentication Failed"===
d.getResponseHeader("X-Reason")&&f.handleLoginRedirect()}}});d.ajaxSettings.traditional=!0})(jQuery,this);
(function(d,e){function m(){this._handler=[]}function f(a){var b="//"+document.location.host,d=document.location.protocol+b;return a==d||a.slice(0,d.length+1)==d+"/"||a==b||a.slice(0,b.length+1)==b+"/"||!/^(\/\/|http:|https:).*/.test(a)}function g(){h=new m;var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState)try{k=JSON.parse(a.responseText).token,h.resolve(k),r()}catch(w){h.reject(a.responseText)}};var b=t;"undefined"===typeof NPC||"undefined"===typeof NPC.isAuthor||NPC.isAuthor||
NPC.isChalus||0===d.location.pathname.indexOf("/content/")||(b="undefined"!==typeof NPC.dsp2&&"function"===typeof NPC.dsp2.isCurrentPageDSP2&&NPC.dsp2.isCurrentPageDSP2()?d.location.pathname.substring(0,d.location.pathname.indexOf("/",1))+"/dsp2"+b:d.location.pathname.substring(0,d.location.pathname.indexOf("/",1))+b);a.open("GET",Granite.HTTP.externalize(b),!0);a.send()}function c(a){var b=a.getAttribute("action");if(!b||f(b))b=a.querySelector('input[name\x3d":cq_csrf_token"]'),b||(b=document.createElement("input"),
b.setAttribute("type","hidden"),b.setAttribute("name",":cq_csrf_token"),a.appendChild(b)),b.setAttribute("value",k)}function p(a){var b=a.getAttribute("action");(!b||f(b))&&(a=a.querySelector('input[name\x3d":cq_csrf_token"]'))&&a.parentElement.removeChild(a)}function q(a){var b=function(a){a=a.target;"form"===a.nodeName.toLowerCase()&&k&&c(a)};a.addEventListener?a.addEventListener("submit",b,!0):a.attachEvent&&a.attachEvent("submit",b)}function r(){setTimeout(function(){h=k=e},66E4)}d.Granite=d.Granite||
{};if(!d.Granite.csrf){d.Granite.csrf={initialised:!1,refreshToken:g};m.prototype={then:function(a,b){this._handler.push({resolve:a,reject:b})},resolve:function(){this._execute("resolve",arguments)},reject:function(){this._execute("reject",arguments)},_execute:function(a,b){if(null===this._handler)throw Error("Promise already completed.");for(var c=0,e=this._handler.length;c<e;c++)this._handler[c][a].apply(d,b);this.then=function(c,e){("resolve"===a?c:e).apply(d,b)};this._handler=null}};var t="/libs/granite/csrf/token.json",
h,k;g();q(document);var u=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(a,b){f(b)&&(this._sameOriginNPC=!0,"get"!==a.toLowerCase()&&(this._csrf=!0));return u.apply(this,arguments)};var l=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(a){if(this._csrf)if(k)this.setRequestHeader("CSRF-Token",k),l.apply(this,arguments);else{var b=this,c=Array.prototype.slice.call(arguments);h||g();h.then(function(a){b.setRequestHeader("CSRF-Token",a);l.apply(b,c)},function(){d.console&&
console.error("Unable to read CSRF meta information");l.apply(b,c)})}else l.apply(this,arguments)};var n=HTMLFormElement.prototype.submit;HTMLFormElement.prototype.submit=function(){if(k){c(this);var a=n.apply(this,arguments);p(this);return a}var b=this;h||g();h.then(function(a){c(b);n.apply(b,arguments);p(b)},function(){d.console&&console.error("Unable to read CSRF meta information");n.apply(b,arguments)});return!1};if(d.Node){var v=Node.prototype.appendChild;Node.prototype.appendChild=function(){var a=
v.apply(this,arguments);if("IFRAME"===a.nodeName)try{a.contentWindow&&!a._csrf&&(a._csrf=!0,q(a.contentWindow.document))}catch(b){a.src&&a.src.length&&f(a.src)&&d.console&&console.error("Unable to attach CSRF token an iframe element on the same origin")}return a}}}})(this);